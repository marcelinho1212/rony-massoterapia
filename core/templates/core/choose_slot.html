{% extends "core/base.html" %}
{% block title %}Escolha data e horário{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h2 class="h4 fw-bold mb-0">Escolha data e horário</h2>
    <div class="text-muted small">{{ professional.name }} • {{ service.name }} ({{ service.duration_minutes }} min)</div>
  </div>
  <a href="{% url 'choose_service' professional.slug %}" class="btn btn-outline-secondary btn-sm">Voltar</a>
</div>

<div class="card border-0 shadow-sm rounded-4">
  <div class="card-body p-4">

    <div class="mb-3">
      <div class="fw-semibold mb-2">Selecione o dia</div>
      <div class="d-flex flex-wrap gap-2">
        {% for d in days %}
          <a class="btn {% if selected_day == d|date:'Y-m-d' %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm"
             href="?day={{ d|date:'Y-m-d' }}">
            {{ d|date:"d/m" }}
          </a>
        {% endfor %}
      </div>
    </div>

    {% if selected_day %}
      <hr class="my-4">

      {% if slots %}
        <form method="post" action="{% url 'confirm_booking' %}">
          {% csrf_token %}
          <input type="hidden" name="professional_slug" value="{{ professional.slug }}">
          <input type="hidden" name="service_id" value="{{ service.id }}">

          <div class="row g-4">
            <div class="col-lg-6">
              <div class="fw-semibold mb-2">Horários disponíveis</div>
              <div class="list-group">
                {% for s in slots %}
                  <label class="list-group-item d-flex align-items-center gap-2">
                    <input class="form-check-input m-0" type="radio" name="slot_iso" value="{{ s|date:'c' }}" required>
                    <span class="fw-semibold">{{ s|date:"H:i" }}</span>
                    <span class="text-muted small ms-auto">{{ selected_day|date:"d/m/Y" }}</span>
                  </label>
                {% endfor %}
              </div>
              <div class="small text-muted mt-2">
                Se não encontrar o horário desejado, escolha outro dia.
              </div>
            </div>

            <div class="col-lg-6">
              <div class="fw-semibold mb-2">Seus dados</div>

              <label class="form-label">Nome completo</label>
              <input class="form-control" name="customer_name" required>

              <label class="form-label mt-3">WhatsApp (com DDI)</label>
              <input class="form-control" name="customer_whatsapp" required placeholder="5531...">

              <button class="btn btn-success btn-lg w-100 mt-4" type="submit">
                Confirmar agendamento no WhatsApp
              </button>

              <div class="small text-muted mt-2">
                O WhatsApp abrirá com a mensagem pronta para envio.
              </div>
            </div>
          </div>
        </form>
      {% else %}
        <div class="alert alert-warning mb-0">
          Não há horários disponíveis para este dia.
        </div>
      {% endif %}
    {% else %}
      <div class="alert alert-info mb-0">
        Escolha um dia para ver os horários disponíveis.
      </div>
    {% endif %}

  </div>
</div>
{% endblock %}
